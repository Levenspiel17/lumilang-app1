import { useState, useEffect, useRef } from "react";

// â”€â”€â”€ ìƒìˆ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LANGUAGES = [
  { code: "en", name: "English",    flag: "ğŸ‡ºğŸ‡¸" },
  { code: "ko", name: "í•œêµ­ì–´",      flag: "ğŸ‡°ğŸ‡·" },
  { code: "ja", name: "æ—¥æœ¬èª",      flag: "ğŸ‡¯ğŸ‡µ" },
  { code: "zh", name: "ä¸­æ–‡",        flag: "ğŸ‡¨ğŸ‡³" },
  { code: "es", name: "EspaÃ±ol",    flag: "ğŸ‡ªğŸ‡¸" },
  { code: "fr", name: "FranÃ§ais",   flag: "ğŸ‡«ğŸ‡·" },
  { code: "de", name: "Deutsch",    flag: "ğŸ‡©ğŸ‡ª" },
  { code: "pt", name: "PortuguÃªs",  flag: "ğŸ‡§ğŸ‡·" },
  { code: "ar", name: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",    flag: "ğŸ‡¸ğŸ‡¦" },
  { code: "hi", name: "à¤¹à¤¿à¤¨à¥à¤¦à¥€",       flag: "ğŸ‡®ğŸ‡³" },
  { code: "ru", name: "Ğ ÑƒÑÑĞºĞ¸Ğ¹",    flag: "ğŸ‡·ğŸ‡º" },
  { code: "it", name: "Italiano",   flag: "ğŸ‡®ğŸ‡¹" },
  { code: "vi", name: "Tiáº¿ng Viá»‡t", flag: "ğŸ‡»ğŸ‡³" },
  { code: "th", name: "à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",    flag: "ğŸ‡¹ğŸ‡­" },
  { code: "tr", name: "TÃ¼rkÃ§e",     flag: "ğŸ‡¹ğŸ‡·" },
];

const TOPICS = [
  { id: "travel",   icon: "âœˆï¸", label: "Travel",      ko: "ì—¬í–‰" },
  { id: "business", icon: "ğŸ’¼", label: "Business",    ko: "ë¹„ì¦ˆë‹ˆìŠ¤" },
  { id: "daily",    icon: "â˜€ï¸", label: "Daily Life",  ko: "ì¼ìƒìƒí™œ" },
  { id: "food",     icon: "ğŸœ", label: "Food",        ko: "ìŒì‹" },
  { id: "health",   icon: "ğŸ¥", label: "Health",      ko: "ê±´ê°•" },
  { id: "shopping", icon: "ğŸ›ï¸", label: "Shopping",   ko: "ì‡¼í•‘" },
  { id: "culture",  icon: "ğŸ­", label: "Culture",     ko: "ë¬¸í™”" },
  { id: "tech",     icon: "ğŸ’»", label: "Technology",  ko: "ê¸°ìˆ " },
];

const MODES = [
  { id: "vocab",     icon: "ğŸ“–", label: "ë‹¨ì–´ í•™ìŠµ",      desc: "Vocabulary" },
  { id: "dialog",    icon: "ğŸ’¬", label: "ë‹¤ì´ì–¼ë¡œê·¸",      desc: "Dialogue" },
  { id: "quiz",      icon: "ğŸ¯", label: "í€´ì¦ˆ",           desc: "Quiz" },
  { id: "ai",        icon: "ğŸ¤–", label: "AI íŠœí„°",        desc: "AI Chat" },
  { id: "community", icon: "ğŸ‘¥", label: "ì»¤ë®¤ë‹ˆí‹°",        desc: "Community" },
];

const VOCAB_DATA = {
  travel: [
    { en: "passport",      ko: "ì—¬ê¶Œ",    ja: "ãƒ‘ã‚¹ãƒãƒ¼ãƒˆ",  zh: "æŠ¤ç…§",     es: "pasaporte",     example: "Don't forget your passport!" },
    { en: "reservation",   ko: "ì˜ˆì•½",    ja: "äºˆç´„",       zh: "é¢„è®¢",     es: "reservaciÃ³n",   example: "I have a reservation for two." },
    { en: "departure",     ko: "ì¶œë°œ",    ja: "å‡ºç™º",       zh: "å‡ºå‘",     es: "salida",        example: "What time is the departure?" },
    { en: "boarding gate", ko: "íƒ‘ìŠ¹êµ¬",  ja: "æ­ä¹—å£",     zh: "ç™»æœºå£",   es: "puerta",        example: "Please go to boarding gate 12." },
    { en: "accommodation", ko: "ìˆ™ì†Œ",    ja: "å®¿æ³Š",       zh: "ä½å®¿",     es: "alojamiento",   example: "We need accommodation for 3 nights." },
  ],
  business: [
    { en: "negotiate",   ko: "í˜‘ìƒí•˜ë‹¤",    ja: "äº¤æ¸‰ã™ã‚‹",   zh: "è°ˆåˆ¤",      es: "negociar",    example: "We need to negotiate the terms." },
    { en: "deadline",    ko: "ë§ˆê°ì¼",      ja: "ç· ã‚åˆ‡ã‚Š",   zh: "æˆªæ­¢æ—¥æœŸ",   es: "fecha lÃ­mite", example: "The deadline is next Friday." },
    { en: "proposal",    ko: "ì œì•ˆì„œ",      ja: "ææ¡ˆæ›¸",     zh: "ææ¡ˆ",      es: "propuesta",   example: "Please review the proposal." },
    { en: "revenue",     ko: "ìˆ˜ìµ",        ja: "åç›Š",       zh: "æ”¶å…¥",      es: "ingresos",    example: "Our revenue increased by 20%." },
    { en: "stakeholder", ko: "ì´í•´ê´€ê³„ì",  ja: "åˆ©å®³é–¢ä¿‚è€…", zh: "åˆ©ç›Šç›¸å…³è€…", es: "parte",       example: "All stakeholders must attend." },
  ],
  daily: [
    { en: "commute",      ko: "í†µê·¼",   ja: "é€šå‹¤",   zh: "é€šå‹¤", es: "viaje",    example: "My commute takes 30 minutes." },
    { en: "grocery",      ko: "ì‹ë£Œí’ˆ", ja: "é£Ÿæ–™å“", zh: "æ‚è´§", es: "comida",   example: "I need to buy groceries." },
    { en: "neighborhood", ko: "ë™ë„¤",   ja: "è¿‘æ‰€",   zh: "ç¤¾åŒº", es: "barrio",   example: "It's a friendly neighborhood." },
    { en: "routine",      ko: "ì¼ê³¼",   ja: "ç¿’æ…£",   zh: "æ—¥å¸¸", es: "rutina",   example: "My morning routine starts at 7." },
    { en: "appointment",  ko: "ì•½ì†",   ja: "äºˆç´„",   zh: "çº¦ä¼š", es: "cita",     example: "I have a doctor's appointment." },
  ],
  food: [
    { en: "appetizer",  ko: "ì• í”¼íƒ€ì´ì €", ja: "å‰èœ",   zh: "å¼€èƒƒèœ", es: "aperitivo",   example: "Shall we order an appetizer?" },
    { en: "seasoning",  ko: "ì–‘ë…",      ja: "èª¿å‘³æ–™", zh: "è°ƒå‘³æ–™", es: "condimento",  example: "This needs more seasoning." },
    { en: "cuisine",    ko: "ìš”ë¦¬",      ja: "æ–™ç†",   zh: "æ–™ç†",   es: "cocina",      example: "I love Italian cuisine." },
    { en: "ingredient", ko: "ì¬ë£Œ",      ja: "ææ–™",   zh: "é£Ÿæ",   es: "ingrediente", example: "What are the main ingredients?" },
    { en: "portion",    ko: "1ì¸ë¶„",     ja: "ä¸€äººå‰", zh: "ä»½é‡",   es: "porciÃ³n",     example: "The portion size is large." },
  ],
  health:   [
    { en: "symptom",    ko: "ì¦ìƒ",   ja: "ç—‡çŠ¶",   zh: "ç—‡çŠ¶", es: "sÃ­ntoma",   example: "Describe your symptoms please." },
    { en: "prescription",ko:"ì²˜ë°©ì „", ja: "å‡¦æ–¹ç®‹", zh: "å¤„æ–¹", es: "receta",    example: "Take this prescription to the pharmacy." },
    { en: "diagnosis",  ko: "ì§„ë‹¨",   ja: "è¨ºæ–­",   zh: "è¯Šæ–­", es: "diagnÃ³stico",example: "The diagnosis was positive." },
    { en: "allergy",    ko: "ì•Œë ˆë¥´ê¸°",ja: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼",zh:"è¿‡æ•",es: "alergia",  example: "I have a nut allergy." },
    { en: "recovery",   ko: "íšŒë³µ",   ja: "å›å¾©",   zh: "åº·å¤", es: "recuperaciÃ³n",example:"Wishing you a speedy recovery." },
  ],
  shopping: [
    { en: "discount",   ko: "í• ì¸",   ja: "å‰²å¼•",   zh: "æŠ˜æ‰£", es: "descuento", example: "Is there a discount available?" },
    { en: "receipt",    ko: "ì˜ìˆ˜ì¦", ja: "é ˜åæ›¸", zh: "æ”¶æ®", es: "recibo",    example: "May I have a receipt please?" },
    { en: "refund",     ko: "í™˜ë¶ˆ",   ja: "æ‰•ã„æˆ»ã—",zh:"é€€æ¬¾", es: "reembolso", example: "I'd like to request a refund." },
    { en: "size",       ko: "ì‚¬ì´ì¦ˆ", ja: "ã‚µã‚¤ã‚º", zh: "å°ºå¯¸", es: "talla",     example: "Do you have this in my size?" },
    { en: "checkout",   ko: "ê³„ì‚°ëŒ€", ja: "ãƒ¬ã‚¸",   zh: "ç»“è´¦", es: "caja",      example: "Let's go to the checkout." },
  ],
  culture: [
    { en: "tradition",  ko: "ì „í†µ",   ja: "ä¼çµ±",   zh: "ä¼ ç»Ÿ", es: "tradiciÃ³n", example: "It's an ancient tradition." },
    { en: "festival",   ko: "ì¶•ì œ",   ja: "ç¥­ã‚Š",   zh: "èŠ‚æ—¥", es: "festival",  example: "The festival lasts three days." },
    { en: "heritage",   ko: "ìœ ì‚°",   ja: "éºç”£",   zh: "é—äº§", es: "patrimonio",example: "It's a UNESCO World Heritage Site." },
    { en: "ceremony",   ko: "ì˜ì‹",   ja: "å¼å…¸",   zh: "ä»ªå¼", es: "ceremonia", example: "The opening ceremony was stunning." },
    { en: "artifact",   ko: "ìœ ë¬¼",   ja: "éºç‰©",   zh: "æ–‡ç‰©", es: "artefacto", example: "The artifact is 3000 years old." },
  ],
  tech: [
    { en: "algorithm",  ko: "ì•Œê³ ë¦¬ì¦˜", ja: "ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ",zh:"ç®—æ³•",  es: "algoritmo", example: "The algorithm processes data fast." },
    { en: "database",   ko: "ë°ì´í„°ë² ì´ìŠ¤",ja:"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",zh:"æ•°æ®åº“",es:"base de datos",example:"The database stores user info." },
    { en: "framework",  ko: "í”„ë ˆì„ì›Œí¬",ja:"ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯",zh:"æ¡†æ¶", es: "framework", example: "React is a popular framework." },
    { en: "deployment", ko: "ë°°í¬",    ja: "ãƒ‡ãƒ—ãƒ­ã‚¤", zh: "éƒ¨ç½²",   es: "despliegue", example: "The deployment went smoothly." },
    { en: "encryption", ko: "ì•”í˜¸í™”",  ja: "æš—å·åŒ–",   zh: "åŠ å¯†",   es: "cifrado",    example: "All data is protected by encryption." },
  ],
};

const DIALOG_DATA = {
  travel: [
    { title: "At the Airport", exchanges: [
      { speaker:"A", en:"Excuse me, where is the check-in counter?", ko:"ì‹¤ë¡€í•©ë‹ˆë‹¤, ì²´í¬ì¸ ì¹´ìš´í„°ê°€ ì–´ë””ì— ìˆë‚˜ìš”?", role:"Traveler" },
      { speaker:"B", en:"It's on the second floor, near the entrance.", ko:"2ì¸µì— ìˆìŠµë‹ˆë‹¤, ì…êµ¬ ê·¼ì²˜ì—ìš”.", role:"Staff" },
      { speaker:"A", en:"Thank you! Is this flight delayed?", ko:"ê°ì‚¬í•©ë‹ˆë‹¤! ì´ í•­ê³µí¸ì´ ì§€ì—°ë˜ë‚˜ìš”?", role:"Traveler" },
      { speaker:"B", en:"No, it's on time. Please go to gate 7.", ko:"ì•„ë‹ˆìš”, ì •ì‹œì…ë‹ˆë‹¤. 7ë²ˆ ê²Œì´íŠ¸ë¡œ ê°€ì„¸ìš”.", role:"Staff" },
    ]},
    { title: "Hotel Check-in", exchanges: [
      { speaker:"A", en:"I have a reservation under Kim.", ko:"ê¹€ ì´ë¦„ìœ¼ë¡œ ì˜ˆì•½í–ˆìŠµë‹ˆë‹¤.", role:"Guest" },
      { speaker:"B", en:"Welcome! Let me pull up your reservation.", ko:"í™˜ì˜í•©ë‹ˆë‹¤! ì˜ˆì•½ì„ í™•ì¸í•´ë³¼ê²Œìš”.", role:"Receptionist" },
      { speaker:"A", en:"I'd prefer a room with a view if possible.", ko:"ê°€ëŠ¥í•˜ë©´ ì „ë§ ìˆëŠ” ë°©ì„ ì›í•©ë‹ˆë‹¤.", role:"Guest" },
      { speaker:"B", en:"Certainly! We have a beautiful ocean view room.", ko:"ë¬¼ë¡ ì´ì£ ! ë©‹ì§„ ì˜¤ì…˜ë·° ë°©ì´ ìˆìŠµë‹ˆë‹¤.", role:"Receptionist" },
    ]},
  ],
  business: [
    { title: "Job Interview", exchanges: [
      { speaker:"A", en:"Tell me about your experience.", ko:"ê·€í•˜ì˜ ê²½í—˜ì— ëŒ€í•´ ë§ì”€í•´ ì£¼ì„¸ìš”.", role:"Interviewer" },
      { speaker:"B", en:"I have 5 years in software development.", ko:"ì €ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì— 5ë…„ ê²½ë ¥ì´ ìˆìŠµë‹ˆë‹¤.", role:"Candidate" },
      { speaker:"A", en:"What's your greatest strength?", ko:"ê°€ì¥ í° ê°•ì ì´ ë¬´ì—‡ì¸ê°€ìš”?", role:"Interviewer" },
      { speaker:"B", en:"I'm highly adaptable and a fast learner.", ko:"ì €ëŠ” ì ì‘ë ¥ì´ ë›°ì–´ë‚˜ê³  ë¹ ë¥´ê²Œ ë°°ì›ë‹ˆë‹¤.", role:"Candidate" },
    ]},
  ],
  daily: [
    { title: "At the Coffee Shop", exchanges: [
      { speaker:"A", en:"What would you like to order?", ko:"ë¬´ì—‡ì„ ì£¼ë¬¸í•˜ì‹œê² ì–´ìš”?", role:"Barista" },
      { speaker:"B", en:"Can I get a large latte, please?", ko:"ë¼ì§€ ë¼ë–¼ í•œ ì” ì£¼ì„¸ìš”.", role:"Customer" },
      { speaker:"A", en:"Hot or iced?", ko:"ëœ¨ê²ê²Œ ë“œë¦´ê¹Œìš”, ì•„ì´ìŠ¤ë¡œ ë“œë¦´ê¹Œìš”?", role:"Barista" },
      { speaker:"B", en:"Iced please, with oat milk.", ko:"ì•„ì´ìŠ¤ë¡œ, ì˜¤íŠ¸ë°€í¬ë¡œ ì£¼ì„¸ìš”.", role:"Customer" },
    ]},
  ],
  food: [
    { title: "Restaurant Order", exchanges: [
      { speaker:"A", en:"Are you ready to order?", ko:"ì£¼ë¬¸í•˜ì‹¤ ì¤€ë¹„ê°€ ë˜ì…¨ë‚˜ìš”?", role:"Waiter" },
      { speaker:"B", en:"Yes, I'll have the pasta with tomato sauce.", ko:"ë„¤, í† ë§ˆí†  ì†ŒìŠ¤ íŒŒìŠ¤íƒ€ë¡œ í• ê²Œìš”.", role:"Customer" },
      { speaker:"A", en:"Any dietary restrictions?", ko:"ì‹ì´ ì œí•œì´ ìˆìœ¼ì‹ ê°€ìš”?", role:"Waiter" },
      { speaker:"B", en:"I'm lactose intolerant.", ko:"ì €ëŠ” ìœ ë‹¹ë¶ˆë‚´ì¦ì´ ìˆì–´ìš”.", role:"Customer" },
    ]},
  ],
  health: [
    { title: "At the Doctor", exchanges: [
      { speaker:"A", en:"What brings you in today?", ko:"ì˜¤ëŠ˜ ì–´ë””ê°€ ë¶ˆí¸í•˜ì„¸ìš”?", role:"Doctor" },
      { speaker:"B", en:"I've had a headache for three days.", ko:"3ì¼ì§¸ ë‘í†µì´ ìˆì–´ìš”.", role:"Patient" },
      { speaker:"A", en:"Any fever or nausea?", ko:"ì—´ì´ë‚˜ êµ¬ì—­ì§ˆì€ ìˆë‚˜ìš”?", role:"Doctor" },
      { speaker:"B", en:"Some nausea, but no fever.", ko:"êµ¬ì—­ì§ˆì€ ì¡°ê¸ˆ ìˆëŠ”ë° ì—´ì€ ì—†ì–´ìš”.", role:"Patient" },
    ]},
  ],
  shopping: [
    { title: "At the Store", exchanges: [
      { speaker:"A", en:"Can I help you find something?", ko:"ì°¾ìœ¼ì‹œëŠ” ê²ƒì´ ìˆë‚˜ìš”?", role:"Staff" },
      { speaker:"B", en:"Yes, I'm looking for a medium-sized jacket.", ko:"ë„¤, ë¯¸ë””ì—„ ì‚¬ì´ì¦ˆ ì¬í‚·ì„ ì°¾ê³  ìˆì–´ìš”.", role:"Customer" },
      { speaker:"A", en:"We have some great options on sale.", ko:"ì„¸ì¼ ì¤‘ì¸ ì¢‹ì€ ìƒí’ˆë“¤ì´ ìˆì–´ìš”.", role:"Staff" },
      { speaker:"B", en:"Perfect, can I try one on?", ko:"ì¢‹ì•„ìš”, ì…ì–´ë³¼ ìˆ˜ ìˆë‚˜ìš”?", role:"Customer" },
    ]},
  ],
  culture: [
    { title: "At a Museum", exchanges: [
      { speaker:"A", en:"This artifact is over 2,000 years old.", ko:"ì´ ìœ ë¬¼ì€ 2,000ë…„ì´ ë„˜ì—ˆì–´ìš”.", role:"Guide" },
      { speaker:"B", en:"That's incredible! What was it used for?", ko:"ë†€ëë„¤ìš”! ì–´ë–¤ ìš©ë„ë¡œ ì“°ì˜€ë‚˜ìš”?", role:"Visitor" },
      { speaker:"A", en:"It was used in religious ceremonies.", ko:"ì¢…êµ ì˜ì‹ì— ì‚¬ìš©ë˜ì—ˆì–´ìš”.", role:"Guide" },
      { speaker:"B", en:"Fascinating. Can I take a photo?", ko:"í¥ë¯¸ë¡­ë„¤ìš”. ì‚¬ì§„ ì°ì–´ë„ ë ê¹Œìš”?", role:"Visitor" },
    ]},
  ],
  tech: [
    { title: "Tech Meeting", exchanges: [
      { speaker:"A", en:"The deployment failed this morning.", ko:"ì˜¤ëŠ˜ ì•„ì¹¨ ë°°í¬ê°€ ì‹¤íŒ¨í–ˆì–´ìš”.", role:"Developer" },
      { speaker:"B", en:"What was the error in the logs?", ko:"ë¡œê·¸ì— ì–´ë–¤ ì—ëŸ¬ê°€ ìˆì—ˆë‚˜ìš”?", role:"Manager" },
      { speaker:"A", en:"A database connection timeout.", ko:"ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° íƒ€ì„ì•„ì›ƒì´ìš”.", role:"Developer" },
      { speaker:"B", en:"Let's fix that before the next release.", ko:"ë‹¤ìŒ ë¦´ë¦¬ì¦ˆ ì „ì— ìˆ˜ì •í•©ì‹œë‹¤.", role:"Manager" },
    ]},
  ],
};

const COMMUNITY_POSTS = [
  { id:1, user:"TanakaSan ğŸ‡¯ğŸ‡µ", avatar:"ğŸ¦Š", time:"2ë¶„ ì „", text:"ì˜¤ëŠ˜ ë°°ìš´ ì˜ì–´ í‘œí˜„: 'It's on the tip of my tongue' - ë­”ê°€ ê¸°ì–µë‚  ë“¯ ë§ ë“¯í•  ë•Œ!", likes:24, replies:3, lang:"ì˜ì–´â†’ì¼ì–´", tags:["í‘œí˜„","idiom"] },
  { id:2, user:"Maria_ES ğŸ‡ªğŸ‡¸",  avatar:"ğŸŒ¸", time:"15ë¶„ ì „", text:"'Por favor' vs 'Please' - Spanish uses it more formally. Anyone notice cultural differences?", likes:18, replies:7, lang:"ì˜ì–´â†’ìŠ¤í˜ì¸ì–´", tags:["ë¬¸í™”","ë¹„êµ"] },
  { id:3, user:"BeijingBuddy ğŸ‡¨ğŸ‡³",avatar:"ğŸ¼",time:"1ì‹œê°„ ì „",text:"Tip: Chinese 'å—' at end of sentence = yes/no question! ä½ å¥½å—ï¼Ÿ(Are you well?)", likes:41, replies:12, lang:"ì¤‘êµ­ì–´", tags:["ë¬¸ë²•íŒ"] },
  { id:4, user:"SeoulStudent ğŸ‡°ğŸ‡·",avatar:"ğŸ­",time:"2ì‹œê°„ ì „",text:"ì¼ë³¸ì–´ë‘ í•œêµ­ì–´ ë¬¸ë²• êµ¬ì¡°ê°€ ë¹„ìŠ·í•´ì„œ ë°°ìš°ê¸° ì‰¬ìš´ ê²ƒ ê°™ì•„ìš”! ì¼ë³¸ì–´ ê³µë¶€í•˜ì‹œëŠ” ë¶„ ìˆë‚˜ìš”?", likes:33, replies:8, lang:"ì¼ë³¸ì–´", tags:["ì§ˆë¬¸"] },
];

// â”€â”€â”€ ìŠ¤íƒ€ì¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CSS = `
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Space+Mono&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0f0e17;--surf:#1a1828;--surf2:#231f38;
  --p:#9b5de5;--a1:#ff6b6b;--a2:#ffd166;--a3:#06d6a0;--a4:#118ab2;
  --tx:#fffffe;--tx2:#a8a4c3;--br:rgba(255,255,255,0.08);--r:18px;
}
body{background:var(--bg);color:var(--tx);font-family:'Nunito',sans-serif;-webkit-tap-highlight-color:transparent}
.app{max-width:430px;min-height:100vh;margin:0 auto;background:var(--bg);position:relative}

/* Header */
.hdr{background:linear-gradient(135deg,#1a0533,#0f1a40);padding:50px 20px 20px;position:relative;overflow:hidden}
.hdr::before{content:'';position:absolute;width:200px;height:200px;background:radial-gradient(circle,rgba(155,93,229,.3),transparent 70%);top:-50px;right:-50px;border-radius:50%}
.hdr-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.logo{font-size:22px;font-weight:900;letter-spacing:-.5px}
.logo span{color:var(--a2)}
.streak{background:rgba(255,107,107,.2);border:1px solid rgba(255,107,107,.4);color:var(--a1);padding:6px 12px;border-radius:20px;font-size:13px;font-weight:700}
.lang-row{display:flex;align-items:center;gap:10px}
.lang-btn{flex:1;background:rgba(255,255,255,.07);border:1px solid var(--br);color:var(--tx);padding:10px 12px;border-radius:12px;font-size:13px;font-family:'Nunito',sans-serif;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;justify-content:center;transition:all .2s}
.lang-btn:hover{background:rgba(155,93,229,.2);border-color:var(--p)}
.arrow{color:var(--a3);font-size:18px}

/* Nav */
.nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;background:rgba(15,14,23,.95);backdrop-filter:blur(20px);border-top:1px solid var(--br);display:flex;padding:10px 8px 24px;z-index:100}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px 4px;border:none;background:none;color:var(--tx2);font-family:'Nunito',sans-serif;font-size:10px;font-weight:700;cursor:pointer;transition:all .2s;border-radius:12px}
.nav-item.on{color:var(--p)}
.nav-dot{width:4px;height:4px;border-radius:50%;background:var(--p);opacity:0;transition:.2s}
.nav-item.on .nav-dot{opacity:1}

/* Scroll */
.scroll{padding:16px 16px 110px}
.sec-title{font-size:13px;font-weight:800;color:var(--tx2);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:12px}

/* Topics */
.topic-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:24px}
.topic-card{background:var(--surf);border:2px solid transparent;border-radius:14px;padding:12px 8px;text-align:center;cursor:pointer;transition:all .2s;display:flex;flex-direction:column;align-items:center;gap:6px}
.topic-card:hover,.topic-card.on{border-color:var(--p);background:rgba(155,93,229,.15);transform:translateY(-2px)}
.topic-icon{font-size:24px}
.topic-lbl{font-size:10px;font-weight:800;color:var(--tx2)}
.topic-card.on .topic-lbl{color:var(--p)}

/* Modes */
.modes{display:flex;gap:10px;overflow-x:auto;padding-bottom:8px;margin-bottom:24px}
.modes::-webkit-scrollbar{display:none}
.mode-card{min-width:100px;background:var(--surf);border:2px solid transparent;border-radius:16px;padding:14px 12px;cursor:pointer;transition:all .2s;text-align:center;flex-shrink:0}
.mode-card.on{border-color:var(--a2);background:rgba(255,209,102,.1)}
.mode-icon{font-size:28px;margin-bottom:6px}
.mode-lbl{font-size:11px;font-weight:800;color:var(--tx)}
.mode-desc{font-size:10px;color:var(--tx2);margin-top:2px}
.mode-card.on .mode-lbl{color:var(--a2)}

/* Stats */
.stats-row{display:flex;gap:10px;margin-bottom:20px}
.stat-card{flex:1;background:var(--surf);border:1px solid var(--br);border-radius:14px;padding:14px 12px;text-align:center}
.stat-num{font-size:24px;font-weight:900}
.stat-lbl{font-size:11px;color:var(--tx2);font-weight:700;margin-top:2px}

/* Progress */
.prog-bar{background:var(--surf2);border-radius:8px;height:6px;margin-bottom:6px;overflow:hidden}
.prog-fill{height:100%;border-radius:8px;background:linear-gradient(90deg,var(--p),var(--a4));transition:width .5s}

/* Vocab Card */
.vocab-card{background:linear-gradient(135deg,var(--surf),var(--surf2));border:1px solid var(--br);border-radius:var(--r);padding:28px 24px;margin-bottom:16px;position:relative;overflow:hidden;cursor:pointer;transition:transform .1s;min-height:220px;display:flex;flex-direction:column;justify-content:center}
.vocab-card::before{content:'';position:absolute;top:-30px;right:-30px;width:120px;height:120px;border-radius:50%;background:radial-gradient(circle,rgba(155,93,229,.15),transparent 70%)}
.vocab-word{font-size:36px;font-weight:900;margin-bottom:6px}
.vocab-ph{font-family:'Space Mono',monospace;font-size:13px;color:var(--a3);margin-bottom:16px}
.vocab-trans{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.trans-pill{background:rgba(255,255,255,.06);border:1px solid var(--br);border-radius:20px;padding:5px 12px;font-size:12px;font-weight:700}
.trans-lang{color:var(--tx2);font-size:10px}
.vocab-ex{background:rgba(6,214,160,.08);border-left:3px solid var(--a3);padding:10px 14px;border-radius:8px;font-size:13px;color:var(--tx2);font-style:italic}
.card-nav{display:flex;justify-content:space-between;align-items:center;margin-top:16px}
.dots{display:flex;gap:6px}
.dot{width:8px;height:8px;border-radius:50%;background:var(--surf2);transition:.3s}
.dot.on{background:var(--p)}
.dot.done{background:var(--a3)}
.card-btns{display:flex;gap:10px}
.btn{padding:10px 20px;border:none;border-radius:12px;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .2s}
.btn-skip{background:var(--surf2);color:var(--tx2)}
.btn-know{background:var(--a3);color:#0f0e17}
.btn-know:hover{transform:scale(1.05);box-shadow:0 4px 15px rgba(6,214,160,.4)}

/* Pill tabs */
.pill-row{display:flex;gap:8px;margin-bottom:16px;overflow-x:auto}
.pill-row::-webkit-scrollbar{display:none}
.pill{border:1px solid var(--br);background:var(--surf);color:var(--tx2);padding:8px 16px;border-radius:20px;font-family:'Nunito',sans-serif;font-size:12px;font-weight:800;cursor:pointer;white-space:nowrap;transition:all .2s}
.pill.on{background:var(--p);border-color:var(--p);color:white}

/* Dialog */
.dialog-card{background:var(--surf);border:1px solid var(--br);border-radius:var(--r);margin-bottom:16px;overflow:hidden}
.dialog-hdr{background:linear-gradient(135deg,rgba(155,93,229,.2),rgba(17,138,178,.2));padding:14px 18px;border-bottom:1px solid var(--br);font-weight:800;font-size:14px}
.dialog-body{padding:16px;display:flex;flex-direction:column;gap:12px}
.exchange{display:flex;gap:10px;align-items:flex-start}
.exchange.right{flex-direction:row-reverse}
.spk{width:32px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;flex-shrink:0}
.spk-A{background:rgba(155,93,229,.3);color:var(--p)}
.spk-B{background:rgba(6,214,160,.2);color:var(--a3)}
.bubble{background:rgba(255,255,255,.04);border:1px solid var(--br);border-radius:12px;padding:10px 14px;flex:1}
.exchange.right .bubble{background:rgba(155,93,229,.1);border-color:rgba(155,93,229,.3)}
.exch-en{font-size:14px;font-weight:700;margin-bottom:4px}
.exch-ko{font-size:12px;color:var(--tx2)}
.role-lbl{font-size:10px;color:var(--tx2);margin-bottom:2px;font-weight:700;letter-spacing:.5px}

/* AI Chat */
.ai-hdr{background:linear-gradient(135deg,rgba(255,107,107,.15),rgba(155,93,229,.15));border:1px solid rgba(255,107,107,.2);border-radius:var(--r);padding:16px;margin-bottom:16px;display:flex;align-items:center;gap:12px}
.ai-avatar{font-size:36px}
.ai-name{font-weight:900;font-size:16px}
.ai-desc{font-size:12px;color:var(--tx2);margin-top:2px}
.ai-status{margin-left:auto;background:rgba(6,214,160,.2);color:var(--a3);font-size:11px;font-weight:700;padding:4px 10px;border-radius:20px}
.chat-msgs{background:var(--surf);border:1px solid var(--br);border-radius:var(--r);padding:16px;min-height:280px;max-height:320px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;margin-bottom:12px}
.chat-msgs::-webkit-scrollbar{width:4px}
.chat-msgs::-webkit-scrollbar-thumb{background:var(--surf2);border-radius:4px}
.msg{display:flex;gap:8px;align-items:flex-start;max-width:85%}
.msg.user{align-self:flex-end;flex-direction:row-reverse}
.msg-av{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;background:rgba(155,93,229,.3)}
.msg.user .msg-av{background:rgba(255,209,102,.2)}
.msg-bub{background:var(--surf2);border-radius:12px;padding:10px 14px;font-size:13px;line-height:1.5}
.msg.user .msg-bub{background:linear-gradient(135deg,var(--p),var(--a4))}
.msg-tr{font-size:11px;color:rgba(255,255,255,.6);margin-top:4px;border-top:1px solid rgba(255,255,255,.1);padding-top:4px}
.chat-row{display:flex;gap:10px}
.chat-in{flex:1;background:var(--surf);border:1px solid var(--br);border-radius:14px;padding:12px 16px;color:var(--tx);font-family:'Nunito',sans-serif;font-size:14px;outline:none;transition:border-color .2s}
.chat-in:focus{border-color:var(--p)}
.send-btn{width:46px;height:46px;border-radius:14px;border:none;background:var(--p);color:white;font-size:18px;cursor:pointer;transition:all .2s;flex-shrink:0}
.send-btn:hover:not(:disabled){transform:scale(1.05);box-shadow:0 0 20px rgba(155,93,229,.4)}
.send-btn:disabled{background:var(--surf2);color:var(--tx2)}
.typing{display:flex;gap:4px;padding:12px 14px}
.td{width:6px;height:6px;border-radius:50%;background:var(--tx2);animation:bounce 1.2s infinite}
.td:nth-child(2){animation-delay:.2s}
.td:nth-child(3){animation-delay:.4s}
@keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-8px)}}
.quick-btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.quick-btn{background:var(--surf);border:1px solid var(--br);color:var(--tx2);padding:7px 12px;border-radius:10px;font-family:'Nunito',sans-serif;font-size:11px;font-weight:700;cursor:pointer}

/* Quiz */
.quiz-card{background:var(--surf);border:1px solid var(--br);border-radius:var(--r);padding:24px;margin-bottom:16px}
.quiz-q{font-size:22px;font-weight:900;margin-bottom:8px}
.quiz-ctx{font-size:13px;color:var(--tx2);margin-bottom:24px;font-style:italic}
.quiz-opts{display:flex;flex-direction:column;gap:10px}
.quiz-opt{background:var(--surf2);border:2px solid transparent;border-radius:14px;padding:14px 18px;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;text-align:left;font-family:'Nunito',sans-serif;color:var(--tx);display:flex;align-items:center;gap:10px}
.quiz-opt:hover:not(:disabled){border-color:var(--p);background:rgba(155,93,229,.1)}
.quiz-opt.correct{border-color:var(--a3);background:rgba(6,214,160,.15)}
.quiz-opt.wrong{border-color:var(--a1);background:rgba(255,107,107,.15)}
.opt-letter{width:28px;height:28px;border-radius:8px;background:var(--br);display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}
.quiz-res{margin-top:16px;padding:14px;border-radius:12px;font-size:14px;font-weight:700}
.res-ok{background:rgba(6,214,160,.1);color:var(--a3)}
.res-no{background:rgba(255,107,107,.1);color:var(--a1)}

/* Community */
.post-card{background:var(--surf);border:1px solid var(--br);border-radius:var(--r);padding:16px;margin-bottom:12px;transition:border-color .2s}
.post-card:hover{border-color:rgba(155,93,229,.4)}
.post-hdr{display:flex;gap:10px;align-items:center;margin-bottom:12px}
.post-av{width:38px;height:38px;border-radius:12px;background:var(--surf2);display:flex;align-items:center;justify-content:center;font-size:20px}
.post-user{font-weight:800;font-size:13px}
.post-meta{font-size:11px;color:var(--tx2)}
.post-lang{margin-left:auto;background:rgba(6,214,160,.1);color:var(--a3);font-size:10px;font-weight:700;padding:3px 8px;border-radius:20px;border:1px solid rgba(6,214,160,.2)}
.post-txt{font-size:14px;line-height:1.6;margin-bottom:12px}
.post-tags{display:flex;gap:6px;margin-bottom:12px}
.tag{background:rgba(155,93,229,.15);color:var(--p);font-size:11px;font-weight:700;padding:3px 10px;border-radius:20px}
.post-acts{display:flex;gap:12px}
.post-act{background:none;border:none;color:var(--tx2);font-family:'Nunito',sans-serif;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:5px;padding:6px 10px;border-radius:10px;transition:all .2s}
.post-act:hover{background:rgba(255,255,255,.06);color:var(--tx)}
.post-act.liked{color:var(--a1)}
.new-post{background:var(--surf);border:1px solid var(--br);border-radius:var(--r);padding:14px;margin-bottom:16px;display:flex;gap:10px;align-items:center;cursor:pointer;transition:border-color .2s}
.new-post:hover{border-color:var(--p)}
.post-ph{flex:1;color:var(--tx2);font-size:14px}
.post-sub{background:var(--p);color:white;border:none;border-radius:10px;padding:8px 16px;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer}
.compose-box{background:var(--surf);border:1px solid var(--br);border-radius:var(--r);padding:16px;margin-bottom:16px}
.compose-ta{width:100%;background:var(--surf2);border:1px solid var(--br);border-radius:12px;padding:12px;color:var(--tx);font-family:'Nunito',sans-serif;font-size:14px;resize:none;height:100px;margin-bottom:12px;outline:none}
.compose-acts{display:flex;gap:8px;justify-content:flex-end}
.btn-cancel{background:var(--surf2);border:none;color:var(--tx2);padding:10px 16px;border-radius:10px;font-family:'Nunito';font-weight:800;cursor:pointer;font-size:13px}

/* History */
.hist-item{background:var(--surf);border:1px solid var(--br);border-radius:14px;padding:14px 16px;margin-bottom:10px;display:flex;align-items:center;gap:12px}
.hist-ico{font-size:24px}
.hist-info{flex:1}
.hist-title{font-size:14px;font-weight:700}
.hist-meta{font-size:12px;color:var(--tx2)}
.hist-score{font-size:13px;font-weight:800;color:var(--a3)}

/* Modal */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:200;display:flex;align-items:flex-end}
.sheet{background:var(--surf);border-radius:24px 24px 0 0;width:100%;max-width:430px;margin:0 auto;padding:20px;max-height:70vh;overflow-y:auto}
.handle{width:40px;height:4px;background:var(--br);border-radius:4px;margin:0 auto 20px}
.sheet-title{font-size:18px;font-weight:900;margin-bottom:16px}
.lang-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.lang-opt{background:var(--surf2);border:2px solid transparent;border-radius:14px;padding:12px 8px;text-align:center;cursor:pointer;transition:all .2s}
.lang-opt:hover,.lang-opt.on{border-color:var(--p);background:rgba(155,93,229,.15)}
.lang-flag{font-size:24px}
.lang-name{font-size:11px;font-weight:700;margin-top:4px}

/* Animations */
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.anim{animation:fadeUp .3s ease forwards}

/* Big button */
.big-btn{width:100%;background:var(--p);border:none;color:white;padding:14px;border-radius:14px;font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;cursor:pointer;margin-top:8px}
`;

// â”€â”€â”€ ì–¸ì–´ ì„ íƒ ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function LangModal({ title, selected, onSelect, onClose }) {
  return (
    <div className="overlay" onClick={onClose}>
      <div className="sheet" onClick={e => e.stopPropagation()}>
        <div className="handle" />
        <div className="sheet-title">{title}</div>
        <div className="lang-grid">
          {LANGUAGES.map(l => (
            <div key={l.code} className={`lang-opt ${selected === l.code ? "on" : ""}`}
              onClick={() => { onSelect(l.code); onClose(); }}>
              <div className="lang-flag">{l.flag}</div>
              <div className="lang-name">{l.name}</div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ ë‹¨ì–´ í•™ìŠµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function VocabMode({ topic, nativeLang }) {
  const words = VOCAB_DATA[topic] || VOCAB_DATA.travel;
  const [idx, setIdx] = useState(0);
  const [known, setKnown] = useState([]);
  const w = words[idx];
  const lang = LANGUAGES.find(l => l.code === nativeLang) || LANGUAGES[1];
  const tr = w[nativeLang] || w.ko || "â€”";

  return (
    <div>
      <div className="stats-row">
        <div className="stat-card"><div className="stat-num" style={{color:"var(--a3)"}}>{known.length}</div><div className="stat-lbl">âœ… ì•”ê¸°ì™„ë£Œ</div></div>
        <div className="stat-card"><div className="stat-num" style={{color:"var(--a2)"}}>{words.length - known.length}</div><div className="stat-lbl">ğŸ“– ë‚¨ì€ë‹¨ì–´</div></div>
        <div className="stat-card"><div className="stat-num" style={{color:"var(--p)"}}>{Math.round(known.length/words.length*100)}%</div><div className="stat-lbl">ğŸ¯ ì™„ì„±ë„</div></div>
      </div>
      <div className="prog-bar"><div className="prog-fill" style={{width:`${idx/words.length*100}%`}} /></div>
      <div style={{fontSize:11,color:"var(--tx2)",marginBottom:16,fontWeight:700}}>{idx+1} / {words.length} ë‹¨ì–´</div>

      <div className="vocab-card anim">
        <div className="vocab-word">{w.en}</div>
        <div className="vocab-ph">[ {w.en} ]</div>
        <div className="vocab-trans">
          <div className="trans-pill"><span className="trans-lang">{lang.flag} </span>{tr}</div>
          {w.ja && nativeLang !== "ja" && <div className="trans-pill"><span className="trans-lang">ğŸ‡¯ğŸ‡µ </span>{w.ja}</div>}
          {w.zh && nativeLang !== "zh" && <div className="trans-pill"><span className="trans-lang">ğŸ‡¨ğŸ‡³ </span>{w.zh}</div>}
          {w.es && nativeLang !== "es" && <div className="trans-pill"><span className="trans-lang">ğŸ‡ªğŸ‡¸ </span>{w.es}</div>}
        </div>
        <div className="vocab-ex">ğŸ’¬ {w.example}</div>
      </div>

      <div className="card-nav">
        <div className="dots">
          {words.map((_, i) => <div key={i} className={`dot ${known.includes(i) ? "done" : i === idx ? "on" : ""}`} />)}
        </div>
        <div className="card-btns">
          <button className="btn btn-skip" onClick={() => setIdx(Math.min(idx+1,words.length-1))}>ë‹¤ìŒ â€º</button>
          <button className="btn btn-know" onClick={() => { setKnown(p=>[...p,idx]); setIdx(Math.min(idx+1,words.length-1)); }}>ì•”ê¸° âœ“</button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ ë‹¤ì´ì–¼ë¡œê·¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DialogMode({ topic, nativeLang }) {
  const dialogs = DIALOG_DATA[topic] || DIALOG_DATA.travel;
  const [di, setDi] = useState(0);
  const [showTr, setShowTr] = useState(true);
  const d = dialogs[di];

  return (
    <div>
      <div className="pill-row">
        {dialogs.map((dl, i) => <button key={i} className={`pill ${i===di?"on":""}`} onClick={() => setDi(i)}>{dl.title}</button>)}
      </div>
      <div className="pill-row">
        <button className={`pill ${showTr?"on":""}`} onClick={() => setShowTr(true)}>ğŸŒ ë²ˆì—­ ë³´ê¸°</button>
        <button className={`pill ${!showTr?"on":""}`} onClick={() => setShowTr(false)}>ğŸ’ª ì˜ì–´ë§Œ</button>
      </div>
      <div className="dialog-card anim">
        <div className="dialog-hdr">ğŸ¬ {d.title}</div>
        <div className="dialog-body">
          {d.exchanges.map((ex, i) => (
            <div key={i} className={`exchange ${ex.speaker==="B"?"right":""}`}>
              <div className={`spk spk-${ex.speaker}`}>{ex.speaker}</div>
              <div className="bubble">
                <div className="role-lbl">{ex.role}</div>
                <div className="exch-en">{ex.en}</div>
                {showTr && <div className="exch-ko">{ex.ko}</div>}
              </div>
            </div>
          ))}
        </div>
      </div>
      <button className="big-btn">ğŸ¤ ë¡¤í”Œë ˆì´ ì—°ìŠµ ì‹œì‘</button>
    </div>
  );
}

// â”€â”€â”€ í€´ì¦ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function QuizMode({ topic }) {
  const words = VOCAB_DATA[topic] || VOCAB_DATA.travel;
  const [qi, setQi] = useState(0);
  const [sel, setSel] = useState(null);
  const [score, setScore] = useState(0);
  const w = words[qi % words.length];
  const options = [w, ...words.filter((_,i)=>i!==qi%words.length).sort(()=>Math.random()-.5).slice(0,3)].sort(()=>Math.random()-.5);
  const letters = ["A","B","C","D"];

  const pick = opt => {
    if (sel) return;
    setSel(opt);
    if (opt.en === w.en) setScore(s=>s+1);
  };

  return (
    <div>
      <div className="stats-row">
        <div className="stat-card"><div className="stat-num" style={{color:"var(--a2)"}}>{score}</div><div className="stat-lbl">ğŸ† ì ìˆ˜</div></div>
        <div className="stat-card"><div className="stat-num" style={{color:"var(--p)"}}>{qi+1}</div><div className="stat-lbl">ğŸ“ ë¬¸ì œ</div></div>
        <div className="stat-card"><div className="stat-num" style={{color:"var(--a3)"}}>{Math.round(score/Math.max(qi,1)*100)}%</div><div className="stat-lbl">âœ¨ ì •í™•ë„</div></div>
      </div>
      <div className="quiz-card anim">
        <div style={{fontSize:11,color:"var(--tx2)",marginBottom:8,fontWeight:700,textTransform:"uppercase",letterSpacing:1}}>í•œêµ­ì–´ ë²ˆì—­ì€?</div>
        <div className="quiz-q">{w.en}</div>
        <div className="quiz-ctx">"{w.example}"</div>
        <div className="quiz-opts">
          {options.map((opt,i) => (
            <button key={i} className={`quiz-opt ${sel?(opt.en===w.en?"correct":sel.en===opt.en?"wrong":""):""}`}
              onClick={() => pick(opt)} disabled={!!sel}>
              <div className="opt-letter">{letters[i]}</div>
              {opt.ko}
            </button>
          ))}
        </div>
        {sel && <div className={`quiz-res ${sel.en===w.en?"res-ok":"res-no"}`}>
          {sel.en===w.en?"âœ… ì •ë‹µ!":"âŒ ì˜¤ë‹µ â€” ì •ë‹µ: "+w.ko}
        </div>}
      </div>
      {sel && <button className="big-btn" style={{background:"var(--a2)",color:"#0f0e17"}} onClick={() => { setSel(null); setQi(q=>q+1); }}>ë‹¤ìŒ ë¬¸ì œ â†’</button>}
    </div>
  );
}

// â”€â”€â”€ AI íŠœí„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AIMode({ topic, nativeLang }) {
  const topicInfo = TOPICS.find(t => t.id === topic);
  const [msgs, setMsgs] = useState([{
    role:"assistant",
    text:`ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” AI ì–¸ì–´ íŠœí„° LUMIì˜ˆìš” ğŸŒŸ\n\nì˜¤ëŠ˜ì€ "${topicInfo?.label || "ì˜ì–´"}" ì£¼ì œë¡œ ëŒ€í™” ì—°ìŠµì„ í•´ë³¼ê²Œìš”!\n\nFeel free to chat with me in English!`,
    tr:"Hello! I'm LUMI, your AI language tutor. Let's practice together!"
  }]);
  const [input, setInput] = useState("");
  const [loading, setLoading] = useState(false);
  const endRef = useRef(null);

  useEffect(() => { endRef.current?.scrollIntoView({ behavior:"smooth" }); }, [msgs]);

  const send = async () => {
    if (!input.trim() || loading) return;
    const userText = input.trim();
    setInput("");
    setMsgs(p => [...p, { role:"user", text:userText }]);
    setLoading(true);

    try {
      const history = msgs.map(m => ({ role: m.role, content: m.text }));
      const res = await fetch("https://api.anthropic.com/v1/messages", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
          model:"claude-sonnet-4-20250514",
          max_tokens:1000,
          system:`You are LUMI, a friendly AI language tutor. Topic: ${topicInfo?.label} (${topicInfo?.ko}). Native language: ${LANGUAGES.find(l=>l.code===nativeLang)?.name || "Korean"}. Respond in English primarily, add Korean translation of key phrases in parentheses. Be encouraging, correct mistakes gently. Keep responses to 2-4 sentences.`,
          messages:[...history, { role:"user", content:userText }]
        })
      });
      const data = await res.json();
      const raw = data.content?.[0]?.text || "Sorry, try again!";
      const parts = raw.split("\n\n");
      setMsgs(p => [...p, { role:"assistant", text:parts[0], tr:parts[1]||"" }]);
    } catch {
      setMsgs(p => [...p, { role:"assistant", text:"Connection error. Please try again! ğŸ˜Š", tr:"ì—°ê²° ì˜¤ë¥˜" }]);
    }
    setLoading(false);
  };

  return (
    <div>
      <div className="ai-hdr">
        <div className="ai-avatar">ğŸ¤–</div>
        <div>
          <div className="ai-name">LUMI AI íŠœí„°</div>
          <div className="ai-desc">Powered by Claude Â· {topicInfo?.ko} ì£¼ì œ</div>
        </div>
        <div className="ai-status">â— ì˜¨ë¼ì¸</div>
      </div>
      <div className="chat-msgs">
        {msgs.map((m,i) => (
          <div key={i} className={`msg ${m.role==="user"?"user":""}`}>
            <div className="msg-av">{m.role==="user"?"ğŸ˜Š":"ğŸ¤–"}</div>
            <div className="msg-bub">
              {m.text}
              {m.tr && <div className="msg-tr">{m.tr}</div>}
            </div>
          </div>
        ))}
        {loading && (
          <div className="msg">
            <div className="msg-av">ğŸ¤–</div>
            <div className="msg-bub"><div className="typing"><div className="td"/><div className="td"/><div className="td"/></div></div>
          </div>
        )}
        <div ref={endRef} />
      </div>
      <div className="chat-row">
        <input className="chat-in" value={input} onChange={e=>setInput(e.target.value)}
          onKeyDown={e=>e.key==="Enter"&&send()} placeholder="ì˜ì–´ë¡œ ë§í•´ë³´ì„¸ìš”..." />
        <button className="send-btn" onClick={send} disabled={loading||!input.trim()}>
          {loading?"â³":"â¤"}
        </button>
      </div>
      <div className="quick-btns">
        {["Give me an example","Correct my English","Teach me a new word","Let's practice dialog"].map(q => (
          <button key={q} className="quick-btn" onClick={() => setInput(q)}>{q}</button>
        ))}
      </div>
    </div>
  );
}

// â”€â”€â”€ ì»¤ë®¤ë‹ˆí‹° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function CommunityMode() {
  const [posts, setPosts] = useState(COMMUNITY_POSTS);
  const [liked, setLiked] = useState([]);
  const [compose, setCompose] = useState(false);
  const [draft, setDraft] = useState("");

  const toggleLike = id => {
    if (liked.includes(id)) {
      setLiked(p=>p.filter(x=>x!==id));
      setPosts(p=>p.map(x=>x.id===id?{...x,likes:x.likes-1}:x));
    } else {
      setLiked(p=>[...p,id]);
      setPosts(p=>p.map(x=>x.id===id?{...x,likes:x.likes+1}:x));
    }
  };

  const submit = () => {
    if (!draft.trim()) return;
    setPosts(p=>[{ id:Date.now(), user:"ë‚˜ ğŸ‘¤", avatar:"ğŸŒŸ", time:"ë°©ê¸ˆ", text:draft, likes:0, replies:0, lang:"í•™ìŠµì¤‘", tags:["ê³µìœ "] },...p]);
    setDraft(""); setCompose(false);
  };

  return (
    <div>
      {compose ? (
        <div className="compose-box">
          <textarea className="compose-ta" value={draft} onChange={e=>setDraft(e.target.value)} placeholder="í•™ìŠµ íŒ, í‘œí˜„, ì§ˆë¬¸ì„ ê³µìœ í•´ë³´ì„¸ìš”..." />
          <div className="compose-acts">
            <button className="btn-cancel" onClick={()=>setCompose(false)}>ì·¨ì†Œ</button>
            <button className="post-sub" onClick={submit}>ê²Œì‹œ âœ¨</button>
          </div>
        </div>
      ) : (
        <div className="new-post" onClick={()=>setCompose(true)}>
          <div style={{fontSize:28}}>âœï¸</div>
          <div className="post-ph">í•™ìŠµ ë‚´ìš©ì„ ê³µìœ í•´ë³´ì„¸ìš”...</div>
          <button className="post-sub">ì‘ì„±</button>
        </div>
      )}
      {posts.map(p => (
        <div key={p.id} className="post-card anim">
          <div className="post-hdr">
            <div className="post-av">{p.avatar}</div>
            <div><div className="post-user">{p.user}</div><div className="post-meta">{p.time}</div></div>
            <div className="post-lang">{p.lang}</div>
          </div>
          <div className="post-txt">{p.text}</div>
          <div className="post-tags">{p.tags.map(t=><span key={t} className="tag">#{t}</span>)}</div>
          <div className="post-acts">
            <button className={`post-act ${liked.includes(p.id)?"liked":""}`} onClick={()=>toggleLike(p.id)}>
              {liked.includes(p.id)?"â¤ï¸":"ğŸ¤"} {p.likes}
            </button>
            <button className="post-act">ğŸ’¬ {p.replies}</button>
            <button className="post-act">ğŸ”– ì €ì¥</button>
          </div>
        </div>
      ))}
    </div>
  );
}

// â”€â”€â”€ í•™ìŠµ ê¸°ë¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function HistoryTab({ history }) {
  const icons = { vocab:"ğŸ“–", dialog:"ğŸ’¬", quiz:"ğŸ¯", ai:"ğŸ¤–", community:"ğŸ‘¥" };
  return (
    <div>
      <div className="stats-row">
        <div className="stat-card"><div className="stat-num" style={{color:"var(--a2)"}}>{history.length}</div><div className="stat-lbl">ğŸ“š ì„¸ì…˜</div></div>
        <div className="stat-card"><div className="stat-num" style={{color:"var(--a3)"}}>{history.reduce((a,h)=>a+(h.words||0),0)}</div><div className="stat-lbl">ğŸ”¤ ë‹¨ì–´</div></div>
        <div className="stat-card"><div className="stat-num" style={{color:"var(--p)"}}>{history.length*5}ë¶„</div><div className="stat-lbl">â±ï¸ ì‹œê°„</div></div>
      </div>
      {history.length===0 ? (
        <div style={{textAlign:"center",padding:"40px 20px",color:"var(--tx2)"}}>
          <div style={{fontSize:48,marginBottom:12}}>ğŸ“</div>
          <div style={{fontWeight:800}}>ì•„ì§ í•™ìŠµ ê¸°ë¡ì´ ì—†ì–´ìš”</div>
          <div style={{fontSize:13,marginTop:8}}>í•™ìŠµì„ ì‹œì‘í•´ë³´ì„¸ìš”!</div>
        </div>
      ) : history.map((item,i) => (
        <div key={i} className="hist-item">
          <div className="hist-ico">{icons[item.mode]||"ğŸ“–"}</div>
          <div className="hist-info">
            <div className="hist-title">{item.topic} Â· {item.modeName}</div>
            <div className="hist-meta">{item.date} Â· {item.words||0}ê°œ ë‹¨ì–´</div>
          </div>
          <div className="hist-score">{item.score||"ì™„ë£Œ"}</div>
        </div>
      ))}
    </div>
  );
}

// â”€â”€â”€ ë©”ì¸ ì•± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export default function App() {
  const [nativeLang, setNativeLang] = useState("ko");
  const [targetLang, setTargetLang] = useState("en");
  const [topic, setTopic] = useState("travel");
  const [mode, setMode] = useState("vocab");
  const [tab, setTab] = useState("learn");
  const [showNative, setShowNative] = useState(false);
  const [showTarget, setShowTarget] = useState(false);
  const [streak] = useState(7);
  const [history, setHistory] = useState([
    { mode:"vocab", modeName:"ë‹¨ì–´í•™ìŠµ", topic:"ì—¬í–‰", date:"ì˜¤ëŠ˜ 09:30", words:5, score:"5/5 âœ¨" },
    { mode:"quiz",  modeName:"í€´ì¦ˆ",    topic:"ë¹„ì¦ˆë‹ˆìŠ¤", date:"ì–´ì œ 20:15", words:8, score:"7/8 ğŸ’ª" },
  ]);

  // ì €ì¥
  useEffect(() => {
    try {
      window.storage?.set("ll_settings", JSON.stringify({ nativeLang, targetLang }));
      window.storage?.set("ll_history", JSON.stringify(history));
    } catch {}
  }, [nativeLang, targetLang, history]);

  // ë¶ˆëŸ¬ì˜¤ê¸°
  useEffect(() => {
    const load = async () => {
      try {
        const s = await window.storage?.get("ll_settings");
        const h = await window.storage?.get("ll_history");
        if (s) { const v = JSON.parse(s.value); setNativeLang(v.nativeLang||"ko"); setTargetLang(v.targetLang||"en"); }
        if (h) setHistory(JSON.parse(h.value));
      } catch {}
    };
    load();
  }, []);

  const nl = LANGUAGES.find(l=>l.code===nativeLang)||LANGUAGES[1];
  const tl = LANGUAGES.find(l=>l.code===targetLang)||LANGUAGES[0];
  const topicInfo = TOPICS.find(t=>t.id===topic);
  const modeInfo  = MODES.find(m=>m.id===mode);

  const renderContent = () => {
    if (tab==="history") return <HistoryTab history={history} />;
    switch(mode) {
      case "vocab":     return <VocabMode topic={topic} nativeLang={nativeLang} />;
      case "dialog":    return <DialogMode topic={topic} nativeLang={nativeLang} />;
      case "quiz":      return <QuizMode topic={topic} />;
      case "ai":        return <AIMode topic={topic} nativeLang={nativeLang} />;
      case "community": return <CommunityMode />;
      default:          return <VocabMode topic={topic} nativeLang={nativeLang} />;
    }
  };

  return (
    <>
      <style>{CSS}</style>
      <div className="app">
        {/* í—¤ë” */}
        <div className="hdr">
          <div className="hdr-top">
            <div className="logo">LUMI<span>Lang</span></div>
            <div className="streak">ğŸ”¥ {streak}ì¼ ì—°ì†</div>
          </div>
          <div className="lang-row">
            <button className="lang-btn" onClick={()=>setShowNative(true)}>{nl.flag} {nl.name}</button>
            <div className="arrow">â‡„</div>
            <button className="lang-btn" onClick={()=>setShowTarget(true)}>{tl.flag} {tl.name}</button>
          </div>
        </div>

        {/* ì½˜í…ì¸  */}
        <div className="scroll">
          {tab==="learn" && (
            <>
              <div className="sec-title">ğŸ“ ì£¼ì œ ì„ íƒ</div>
              <div className="topic-grid">
                {TOPICS.map(t => (
                  <div key={t.id} className={`topic-card ${topic===t.id?"on":""}`} onClick={()=>setTopic(t.id)}>
                    <div className="topic-icon">{t.icon}</div>
                    <div className="topic-lbl">{t.ko}</div>
                  </div>
                ))}
              </div>
              <div className="sec-title">ğŸ® í•™ìŠµ ëª¨ë“œ</div>
              <div className="modes">
                {MODES.map(m => (
                  <div key={m.id} className={`mode-card ${mode===m.id?"on":""}`} onClick={()=>setMode(m.id)}>
                    <div className="mode-icon">{m.icon}</div>
                    <div className="mode-lbl">{m.label}</div>
                    <div className="mode-desc">{m.desc}</div>
                  </div>
                ))}
              </div>
              <div className="sec-title">{topicInfo?.icon} {topicInfo?.ko} Â· {modeInfo?.label}</div>
            </>
          )}
          {renderContent()}
        </div>

        {/* í•˜ë‹¨ ë„¤ë¹„ */}
        <div className="nav">
          {[{id:"learn",icon:"ğŸ ",label:"í™ˆ"},{id:"history",icon:"ğŸ“Š",label:"ê¸°ë¡"},{id:"profile",icon:"ğŸ‘¤",label:"í”„ë¡œí•„"}].map(t => (
            <button key={t.id} className={`nav-item ${tab===t.id?"on":""}`} onClick={()=>setTab(t.id)}>
              <div style={{fontSize:22}}>{t.icon}</div>
              <div>{t.label}</div>
              <div className="nav-dot" />
            </button>
          ))}
        </div>

        {/* ëª¨ë‹¬ */}
        {showNative && <LangModal title="ë‚´ ëª¨êµ­ì–´ ì„ íƒ" selected={nativeLang} onSelect={setNativeLang} onClose={()=>setShowNative(false)} />}
        {showTarget && <LangModal title="í•™ìŠµí•  ì–¸ì–´ ì„ íƒ" selected={targetLang} onSelect={setTargetLang} onClose={()=>setShowTarget(false)} />}
      </div>
    </>
  );
}
